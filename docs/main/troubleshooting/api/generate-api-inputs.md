---
title: "Generate API inputs"
slug: "/generate-api-inputs"
sidebar_position: 5
---

import ListAdmonition from '@site/src/components/ListAdmonition';
import Tabs from '@theme/Tabs';
import TabItem from '@theme/TabItem';

# How to generate API inputs

This page provides information on how to generate the following API inputs:
* Headers:
  * [`IMX-Timestamp`](#imx-timestamp-string)
  * [`x-imx-eth-address`](#x-imx-eth-address-string)
  * [`IMX-Signature`, `x-imx-eth-signature`](#imx-signature-string-x-imx-eth-signature-string-auth_signature-string)
* Request body params:
  * [`stark_signature`](#stark_signature-string)
  * [`auth_signature`](#imx-signature-string-x-imx-eth-signature-string-auth_signature-string)

## `IMX-Timestamp` (string)

The `IMX-Timestamp` can be generated by this example Javascript function:
```js title="Javascript"
const timestamp = Math.floor(Date.now() / 1000).toString();
```

## `x-imx-eth-address` (string)
This is the public Ethereum address of the user executing the transaction.

## `IMX-Signature` (string), `x-imx-eth-signature` (string), `auth_signature` (string)
<ListAdmonition title="Steps:">
  <ul>
    <li><a href="#1-get-etheruem-signer">Get Ethereum signer</a></li>
    <li><a href="#2-get-imx-timestamp">Get message to be signed</a></li>
    <li><a href="#3-serialize-the-signature">Serialize the signature</a></li>
  </ul>
</ListAdmonition>

### 1. Get Ethereum signer
Signers are abstractions of user accounts that can be used to sign transactions. A user's private key is required to generate them. Read more [here](../guides/basic-guides/generate-signers/index.md#using-signers-to-get-user-signatures).

In order to generate the `IMX-Signature` and `x-imx-eth-signature` headers, we need an Ethereum signer for the user.

See [here](https://docs.ethers.io/v5/api/signer/) on how to generate these signers.

### 2. Get message

Different messages are required by the different attributes:
<table>
  <tbody>
    <tr>
      <th>Param</th>
      <th>Message</th>
    </tr>
    <tr>
      <td><code>IMX-Signature</code></td>
      <td><a href="#imx-timestamp-string">IMX-Timestamp</a></td>
    </tr>
    <tr>
      <td><code>x-imx-eth-signature</code></td>
      <td>The message to be signed depends on each transaction. Typically, it contains information about the transaction that requires the user signature.
        <br/><br/>
        Our API contains endpoints allowing you to obtain signable messages:
        <ul>
          <li><a href="/reference/#/operations/getSignableDeposit">getSignableDeposit</a></li>
          <li><a href="/reference/#/operations/getSignableOrder">getSignableOrder</a></li>
          <li><a href="/reference/#/operations/getSignableCancelOrder">getSignableCancelOrder</a></li>
          <li><a href="/reference/#/operations/getSignableTransfer">getSignableTransfer</a></li>
          <li><a href="/reference/#/operations/getSignableWithdrawal">getSignableWithdrawal</a></li>
          <li><a href="/reference/#/operations/getSignableTrade">getSignableTrade</a></li>
          <li><a href="/reference/#/operations/getExchangeSignableTransfer">getExchangeSignableTransfer</a></li>
        </ul>
      </td>
    </tr>
    <tr>
      <td><code>auth_signature</code></td>
      <td>See <a href="#how-to-get-the-message-for-the-auth_signature">below</a></td>
    </tr>
  </tbody>
</table>

#### How to get the message for the `auth_signature`?

The `auth_signature` param is used in the [mintTokens](https://docs.x.immutable.com/reference/#/operations/mintTokens) request.

1. Put together an object like the following Javascript example:
```js title="Javascript"
const object = {
  contract_address: "string",
  royalties: [ // Optional
    {
      recipient: "string",
      percentage: "string",
    },
  ]
  users: [
    {
      ether_key: "string",
      tokens: [
        {
          id: "string",
          blueprint: "string",
          royalties: [ // Optional
            {
              recipient: "string",
              percentage: "string",
            },
          ]
        }
      ]
    }
  ],
};
```

2. Create a hash of that object that becomes the `message` to be signed to get the `auth_signature`:
```js title="Javascript"
import { keccak256 } from '@ethersproject/keccak256';
import { toUtf8Bytes } from '@ethersproject/strings';

const message = keccak256(toUtf8Bytes(JSON.stringify(object)));
```

### 3. Serialize the signature
Implement a function using the `signer` and `message` obtained in the previous steps like the following Typescript example:
```ts title="Typescript"
export async function signRaw(
  message: string,
  signer: Signer,
): Promise<string> {
  const signature = deserializeSignature(await signer.signMessage(message));
  return serializeEthSignature(signature);
}
```

Where `deserializeSignature()` looks like:
```ts title="Typescript"
import BN from 'bn.js'; // https://www.npmjs.com/package/bn.js
import * as encUtils from 'enc-utils'; // https://www.npmjs.com/package/enc-utils

type SignatureOptions = {
  r: BN;
  s: BN;
  recoveryParam: number | null | undefined;
};

function importRecoveryParam(v: string): number | undefined {
  return v.trim()
    ? new BN(v, 16).cmp(new BN(27)) !== -1
      ? new BN(v, 16).sub(new BN(27)).toNumber()
      : new BN(v, 16).toNumber()
    : undefined;
}

function deserializeSignature(sig: string, size = 64): SignatureOptions {
  sig = encUtils.removeHexPrefix(sig);
  return {
    r: new BN(sig.substring(0, size), 'hex'),
    s: new BN(sig.substring(size, size * 2), 'hex'),
    recoveryParam: importRecoveryParam(sig.substring(size * 2, size * 2 + 2)),
  };
}
```

and `serializeEthSignature()` looks like:
```ts title="Typescript"
function serializeEthSignature(sig: SignatureOptions): string {
  // This is because golang appends a recovery param
  // https://github.com/ethers-io/ethers.js/issues/823
  return encUtils.addHexPrefix(
    encUtils.padLeft(sig.r.toString(16), 64) +
      encUtils.padLeft(sig.s.toString(16), 64) +
      encUtils.padLeft(sig.recoveryParam?.toString(16) || '', 2),
  );
}
```

## `stark_signature` (string)

The `stark_signature` is required in the request body params of certain endpoints. It is obtained by using a Stark signer to sign the `payload_hash` produced in the response of the following corresponding endpoints:

| Action | Endpoint(s) requiring `stark_signature` | Endpoint(s) providing `payload_hash` to be signed |
| --- | --- | --- |
| Create orders | [createOrder](https://docs.x.immutable.com/reference#/operations/createOrder)  | <a href="https://docs.x.immutable.com/reference#/operations/getSignableOrderV1">getSignableOrderV1</a><br/><a href="https://docs.x.immutable.com/reference#/operations/getSignableOrder">getSignableOrder</a> |
| Cancel orders | [cancelOrder](https://docs.x.immutable.com/reference#/operations/cancelOrder) | [getSignableCancelOrder](https://docs.x.immutable.com/reference#/operations/getSignableCancelOrder) |
| Create transfers | [createTransfer](https://docs.x.immutable.com/reference#/operations/createTransfer)<br/>[createTransferV1](https://docs.x.immutable.com/reference#/operations/createTransferV1) | [getSignableTransfer](https://docs.x.immutable.com/reference#/operations/getSignableTransfer])<br/>[getSignableTransferV1](https://docs.x.immutable.com/reference#/operations/getSignableTransferV1) |
| Create withdrawals | [createWithdrawal](https://docs.x.immutable.com/reference#/operations/createWithdrawal) | [getSignableWithdrawal](https://docs.x.immutable.com/reference#/operations/getSignableWithdrawal) |
| Create trades | [createTrade](https://docs.x.immutable.com/reference#/operations/createTrade) | [getSignableTrade](https://docs.x.immutable.com/reference#/operations/getSignableTrade) |
| Create exchange transfers | [createExchangeTransfer](https://docs.x.immutable.com/reference#/operations/createExchangeTransfer) | [getExchangeSignableTransfer](https://docs.x.immutable.com/reference#/operations/getExchangeSignableTransfer) |

<ListAdmonition title="Steps:">
  <ul>
    <li><a href="#1-get-message-to-be-signed">Get message to be signed</a></li>
    <li><a href="#2-generate-stark-signer-and-sign-the-message">Generate StarkSigner and sign the message</a></li>
  </ul>
</ListAdmonition>

### 1. Get message to be signed

Call the corresponding endpoint to the one requiring the `stark_signature` that gets the `payload_hash` to be signed (ie. the endpoint that provides the `payload_hash` for the [createWithdrawal](https://docs.x.immutable.com/reference#/operations/createWithdrawal) endpoint is the [getSignableWithdrawal](https://docs.x.immutable.com/reference#/operations/getSignableWithdrawal) endpoint).

### 2. Generate Stark signer and sign the message

Use the Core SDK to generate the Stark signers. See instructions [here](../guides/basic-guides/generate-signers/index.md#core-sdk).

Use the Stark signer to sign the `payload_hash` in [Step 1](#1-get-message-to-be-signed):

<Tabs>
  <TabItem value="typescript" label="Typescript Core SDK">

```ts
const starkSignature = await starkSigner.signMessage(payloadHash);
```
  </TabItem>
  <TabItem value="kotlin" label="Kotlin (JVM) Core SDK">

```kotlin
val starkSignature = starkSigner.signMessage(response.payloadHash)
``` 
  </TabItem>
  <TabItem value="Swift" label="Swift Core SDK">

```swift
let starkSignature = try await starkSigner.signMessage(signableTrade.payloadHash)
```
  </TabItem>
  <TabItem value="go" label="Golang Core SDK">

```go
signature, err := l2Signer.SignMessage(message)
```
  </TabItem>
</Tabs>