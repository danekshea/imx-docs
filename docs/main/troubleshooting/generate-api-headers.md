---
title: "How to generate API headers"
slug: "/how-to-generate-api-headers"
sidebar_position: 5
---

import ListAdmonition from '@site/src/components/ListAdmonition';

<ListAdmonition title="Headers:">
  <ul>
    <li><a href="#projects"><code>IMX-Timestamp</code></a></li>
    <li><a href="#projects"><code>x-imx-eth-address</code></a></li> 
    <li><a href="#projects"><code>IMX-Signature</code> and <code>x-imx-eth-signature</code></a></li>   
  </ul>
</ListAdmonition>

## `IMX-Timestamp` (string)

The `IMX-Timestamp` can be generated by this example Javascript function:
```js title="Javascript"
const timestamp = Math.floor(Date.now() / 1000).toString();
```

## `x-imx-eth-address` (string)
This is the public Ethereum address of the user executing the transaction.

## `IMX-Signature` (string) and `x-imx-eth-signature` (string)
<ListAdmonition title="Steps:">
  <ul>
    <li><a href="#1-get-etheruem-signer">Get Ethereum signer</a></li>
    <li><a href="#2-get-imx-timestamp">Get message to be signed</a></li>
    <li><a href="#3-serialize-the-signature">Serialize the signature</a></li>
  </ul>
</ListAdmonition>

### 1. Get Ethereum signer
Signers are abstractions of user accounts that can be used to sign transactions. A user's private key is required to generate them. Read more [here](../guides/basic-guides/generate-signers/index.md#using-signers-to-get-user-signatures).

In order to generate the `IMX-Signature` and `x-imx-eth-signature` headers, we need an Ethereum signer for the user.

See [here](https://docs.ethers.io/v5/api/signer/) on how to generate these signers.

### 2. Get message

Different messages are required by the different header types:
<table>
  <tbody>
    <tr>
      <th>Header</th>
      <th>Message</th>
    </tr>
    <tr>
      <td><code>IMX-Signature</code></td>
      <td><a href="#imx-timestamp-string">IMX-Timestamp</a></td>
    </tr>
    <tr>
      <td><code>x-imx-eth-signature</code></td>
      <td>The message to be signed depends on each transaction. Typically, it contains information about the transaction that requires the user signature.
        <br/><br/>
        Our API contains endpoints allowing you to obtain signable messages:
        <ul>
          <li><a href="/reference/#/operations/getSignableDeposit">getSignableDeposit</a></li>
          <li><a href="/reference/#/operations/getSignableOrder">getSignableOrder</a></li>
          <li><a href="/reference/#/operations/getSignableCancelOrder">getSignableCancelOrder</a></li>
          <li><a href="/reference/#/operations/getSignableTransfer">getSignableTransfer</a></li>
          <li><a href="/reference/#/operations/getSignableWithdrawal">getSignableWithdrawal</a></li>
          <li><a href="/reference/#/operations/getSignableTrade">getSignableTrade</a></li>
          <li><a href="/reference/#/operations/getExchangeSignableTransfer">getExchangeSignableTransfer</a></li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>

### 3. Serialize the signature
Implement a function using the `signer` and `message` obtained in the previous steps like the following Typescript example:
```ts title="Typescript"
export async function signRaw(
  message: string,
  signer: Signer,
): Promise<string> {
  const signature = deserializeSignature(await signer.signMessage(message));
  return serializeEthSignature(signature);
}
```

Where `deserializeSignature()` looks like:
```ts title="Typescript"
function deserializeSignature(sig: string, size = 64): SignatureOptions {
  sig = encUtils.removeHexPrefix(sig);
  return {
    r: new BN(sig.substring(0, size), 'hex'),
    s: new BN(sig.substring(size, size * 2), 'hex'),
    recoveryParam: importRecoveryParam(sig.substring(size * 2, size * 2 + 2)),
  };
}
```

and `serializeEthSignature()` looks like:
```ts title="Typescript"
function serializeEthSignature(sig: SignatureOptions): string {
  // This is because golang appends a recovery param
  // https://github.com/ethers-io/ethers.js/issues/823
  return encUtils.addHexPrefix(
    encUtils.padLeft(sig.r.toString(16), 64) +
      encUtils.padLeft(sig.s.toString(16), 64) +
      encUtils.padLeft(sig.recoveryParam?.toString(16) || '', 2),
  );
}
```
